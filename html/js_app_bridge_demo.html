<!DOCTYPE html>
<html lang="en">
<head>
    <title>Web-APP API</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <script src="https://raw.githubusercontent.com/github/fetch/master/fetch.js"></script>

    <script>
    function printCookies() {
      console.log(document.cookie);
      alert(document.cookie);
    };

    // 加入购物车
    function addToCart(goodsInfo){
      // Android
      try {
        window.appDispose.addToCart(goodsInfo);
        return;
      } catch (e) {
        console.log('Call Android Exception : ' + e.toString());
      }
      // iOS8+
      try {
        window.webkit.messageHandlers.addToCart.postMessage(goodsInfo);
        return;
      } catch (e) {
        console.log('Call iOS Exception : ' + e.toString());
      }
    };

    // 添加套装到购物车
    function addBundleToCart(){
      let bundleInfo = '{"bundleId":6326230515036721153, "activityId":6326230515019943936}';
      this.addToCart(bundleInfo);
    }

    //  添加商品购物车
    function addGoodsToCart(){
      let goodsInfo = '{"goodsId":330614780, "isPresell":false}';
      this.addToCart(goodsInfo);
    }

    function fetchShareFromNative(shareInfo) {
       // Android
      try {
        // 在receiveAppCallback中获取调用结果
        window.appDispose.setShareInfo(shareInfo);
        return;
      } catch (e) {
        console.log('Call Android Exception : ' + e.toString());
      }
      // iOS8+
      try {
        // 在receiveAppCallback中获取调用结果
        window.webkit.messageHandlers.setShareInfo.postMessage(shareInfo);
        return;
      } catch (e) {
        console.log('Call iOS Exception : ' + e.toString());
      }
    };

    function fetchShareMiniProgram(shareInfo) {
     // Android
      try {
        window.appDispose.shareMiniProgram(shareInfo);
        return;
      } catch (e) {
        console.log('Call Android Exception : ' + e.toString());
      }
      // iOS8+
      try {
        window.webkit.messageHandlers.shareMiniProgram.postMessage(shareInfo);
        return;
      } catch (e) {
        console.log('Call iOS Exception : ' + e.toString());
      }
    };

    function fetchShareWebpageCustomerImage() {
      let webpageInfo = '{"title":"我是自定义图","description":"我是描述","webpageUrl":"https://www.zskuaixiao.com","webpageThumb":"http://www.wenphoto.com/uploads/article/20150815/caa8967c66ed5d943015fcd222dd7b23.jpg" }'
      this.fetchShareFromNative(webpageInfo);
    };

    function fetchShareWebpageSnapshotImage() {
      let webpageInfo = '{"title":"我是屏幕截图","description":"我是描述","webpageUrl":"https://www.zskuaixiao.com", "useSnapshotImage": true}'
      this.fetchShareFromNative(webpageInfo);
    };

    function fetchShareWebpageSnapshotFull() {
      let webpageInfo = '{"title":"我是屏幕长图","description":"我是描述","webpageUrl":"https://www.zskuaixiao.com", "useSnapshotImage": true, "isSnapshotFullContent": true}'
      this.fetchShareFromNative(webpageInfo);
    };

    function fetchShareWebpageDefault() {
      let webpageInfo = '{"title":"我是默认图","description":"我是描述","webpageUrl":"https://www.zskuaixiao.com"}'
      this.fetchShareFromNative(webpageInfo);
    };

    function fetchShareTextFromNative() {
      let textInfo = '{"title":"我是标题哈哈哈哈哈哈哈哈哈哈有毒哈哈哈哈呃"}';
      this.fetchShareFromNative(textInfo);
    };

    function fetchShareImageFromNative() {
      let imageInfo = '{"image": "http://www.wenphoto.com/uploads/article/20150815/caa8967c66ed5d943015fcd222dd7b23.jpg"}';
      this.fetchShareFromNative(imageInfo);
    };

    function fetchShareSnapshotImage() {
      let imageInfo = '{"useSnapshotImage": true}';
      this.fetchShareFromNative(imageInfo);
    };

    function fetchSnapshotFullContent() {
      let imageInfo = '{"useSnapshotImage": true, "isSnapshotFullContent": true}';
      this.fetchShareFromNative(imageInfo);
    };

    function fetchShareMiniProgramFromNative() {
      let program = '{"title": "小程序-默认图", "miniProgramType": "test"}'
      this.fetchShareMiniProgram(program);
    };

    function fetchShareMiniProgramCustomerImage() {
      let program = '{"title": "小程序-自定义图", "miniProgramType": "test", "image": "http://www.wenphoto.com/uploads/article/20150815/caa8967c66ed5d943015fcd222dd7b23.jpg"}'
      this.fetchShareMiniProgram(program);
    };

    function fetchShareMiniProgramSnapshotImage() {
      let program = '{"title": "小程序-屏幕截图", "miniProgramType": "test", "useSnapshotImage": true}'
      this.fetchShareMiniProgram(program);
    };

    function fetchShareMiniProgramSnapshotFull() {
      let program = '{"title": "小程序-屏幕长图", "miniProgramType": "test", "useSnapshotImage": true, "isSnapshotFullContent": true}'
      this.fetchShareMiniProgram(program);
    };

    function fetchShareMiniProgramFromNativePreview() {
      let program = '{"title": "小程序-默认图", "miniProgramType": "preview"}'
      this.fetchShareMiniProgram(program);
    };

    function fetchShareMiniProgramCustomerImagePreview() {
      let program = '{"title": "小程序-自定义图", "miniProgramType": "preview", "image": "http://www.wenphoto.com/uploads/article/20150815/caa8967c66ed5d943015fcd222dd7b23.jpg"}'
      this.fetchShareMiniProgram(program);
    };

    function fetchShareMiniProgramSnapshotImagePreview() {
      let program = '{"title": "小程序-屏幕截图", "miniProgramType": "preview", "useSnapshotImage": true}'
      this.fetchShareMiniProgram(program);
    };

    function fetchShareMiniProgramSnapshotFullPreview() {
      let program = '{"title": "小程序-屏幕长图", "miniProgramType": "preview", "useSnapshotImage": true, "isSnapshotFullContent": true}'
      this.fetchShareMiniProgram(program);
    };


    function fetchShareMiniProgramFromNativeRelease() {
      let program = '{"title": "小程序-默认图", "miniProgramType": "release"}'
      this.fetchShareMiniProgram(program);
    };

    function fetchShareMiniProgramCustomerImageRelease() {
      let program = '{"title": "小程序-自定义图", "miniProgramType": "release", "image": "http://www.wenphoto.com/uploads/article/20150815/caa8967c66ed5d943015fcd222dd7b23.jpg"}'
      this.fetchShareMiniProgram(program);
    };

    function fetchShareMiniProgramSnapshotImageRelease() {
      let program = '{"title": "小程序-屏幕截图", "miniProgramType": "release", "useSnapshotImage": true}'
      this.fetchShareMiniProgram(program);
    };

    function fetchShareMiniProgramSnapshotFullRelease() {
      let program = '{"title": "小程序-屏幕长图", "miniProgramType": "release", "useSnapshotImage": true, "isSnapshotFullContent": true}'
      this.fetchShareMiniProgram(program);
    };

    function launchMiniProgramTest() {
      let program = '{"path": "pages/reward/reward", "miniProgramType": "test"}';
      // Android
      try {
        window.appDispose.launchMiniProgram(program);
        return;
      } catch (e) {
        console.log('Call Android Exception : ' + e.toString());
      }
      // iOS8+
      try {
        window.webkit.messageHandlers.launchMiniProgram.postMessage(program);
        return;
      } catch (e) {
        console.log('Call iOS Exception : ' + e.toString());
      }
    };

    function launchMiniProgramPreview() {
      let program = '{"path": "pages/reward/reward", "miniProgramType": "preview"}';
      // Android
      try {
        window.appDispose.launchMiniProgram(program);
        return;
      } catch (e) {
        console.log('Call Android Exception : ' + e.toString());
      }
      // iOS8+
      try {
        window.webkit.messageHandlers.launchMiniProgram.postMessage(program);
        return;
      } catch (e) {
        console.log('Call iOS Exception : ' + e.toString());
      }
    };

    function launchMiniProgramRelease() {
      let program = '{"path": "pages/reward/reward", "miniProgramType": "release"}';
      // Android
      try {
        window.appDispose.launchMiniProgram(program);
        return;
      } catch (e) {
        console.log('Call Android Exception : ' + e.toString());
      }
      // iOS8+
      try {
        window.webkit.messageHandlers.launchMiniProgram.postMessage(program);
        return;
      } catch (e) {
        console.log('Call iOS Exception : ' + e.toString());
      }
    };

    function fetchUserFromNative() {
      // Android
      try {
        // 在receiveAppCallback中获取调用结果
        window.appDispose.getUser();
        return;
      } catch (e) {
        console.log('Call Android Exception : ' + e.toString());
      }
      // iOS8+
      try {
        // 在receiveAppCallback中获取调用结果
        window.webkit.messageHandlers.getUser.postMessage(null);
        return;
      } catch (e) {
        console.log('Call iOS Exception : ' + e.toString());
      }
    };

    function receiveAppCallback(platform, msgHandler, response) {
      console.log('回调平台：'+ platform);
      console.log(response);
      if (msgHandler == 'getUser') {
        alert('user.name = ' + response.name);
      } else if (msgHandler == 'setShareInfo') {
        alert('share resule = ' + response.shareResult);
      } else if (msgHandler == 'shareMiniProgram'){
        alert('Mini Program resule = ' + response.shareResult);
      }
    };

    function _serverRequestError(statusCode) {
        var errorStr = '';
        if (statusCode === 400) {
            errorStr = '服务器无法解析请求';
        } else if (statusCode === 401) {
            errorStr = '请先登录授权';
        } else if (statusCode === 403) {
            errorStr = '服务器拒绝请求';
        } else if (statusCode === 404) {
            errorStr = '服务器未找到请求页';
        } else if (statusCode === 500) {
            errorStr = '服务器遇到错误，无法完成请求';
        } else if (statusCode === 501) {
            errorStr = '服务器不支持所请求的功能';
        } else if (statusCode === 502) {
            errorStr = '服务器从上游服务器收到一个无效的响应';
        } else if (statusCode === 503) {
            errorStr = '服务器繁忙';
        } else if (statusCode === 504) {
            errorStr = '网关超时';
        } else if (statusCode === 455) {
            errorStr = '版本过低';
        }
        return statusCode.toString() + " " + errorStr;
    };

    function fetchStoreInfoAPI() {
        var apiUrl = 'http://store.51dinghuo.cc/api/store/info';

        fetch(apiUrl, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'laimi-client-version': 'ios.store.client:2.20.0',
            },
            credentials: 'same-origin'
        })
        .then(function(response) {
            if (response.ok) {
                return response.json();
            } else {
                var error = new Error(_serverRequestError(response.status));
                throw error;
            }
        })
        .then(function(responseData) {
            console.log(JSON.stringify(responseData));
            alert(JSON.stringify(responseData));
        })
        .catch(function(error) {
            console.log(error.message);
            alert(error.message);
        });
    };

  </script>

</head>
<style type="text/css">
li {margin: 15px}

</style>
<body>
<img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1533962645100&di=45b71fd1bc2a454e7727a34c4a61fa18&imgtype=0&src=http%3A%2F%2Fimg15.3lian.com%2F2015%2Ff2%2F45%2Fd%2F77.jpg" border="1" width="400" >
<ul>
    <li><a href="https://m.jd.com/">京东H5</a></li>
    <li><a href="tel:18475555555">拨打电话</a></li>
    <li><a href="fmcgshop://goods/1600488">商品详情 (goodsId=1600488)</a></li>
    <li><a href="fmcgshop://activity/11143">活动商品列表 (activityId=11143)</a></li>
    <li><a href="fmcgshop://billDetail/2797">订单详情 (billId=2797)</a></li>
    <li><a href="fmcgshop://homepage">homepage</a></li>
    <li><button onclick="fetchUserFromNative()">call getUser</button></li>
    <li><button onclick="fetchShareWebpageCustomerImage()">分享连接-自定义图</button></li>
    <li><button onclick="fetchShareWebpageSnapshotImage()">分享连接-屏幕截图</button></li>
    <li><button onclick="fetchShareWebpageSnapshotFull()">分享连接-屏幕长图</button></li>
    <li><button onclick="fetchShareWebpageDefault()">分享连接-默认图</button></li>
    <li><button onclick="fetchShareTextFromNative()">分享文字</button></li>
    <li><button onclick="fetchShareImageFromNative()">分享图片-自定义图</button></li>
    <li><button onclick="fetchShareSnapshotImage()">分享图片-屏幕截图</button></li>
    <li><button onclick="fetchSnapshotFullContent()">分享图片-屏幕长图</button></li>

    <li><button onclick="fetchShareMiniProgramFromNative()">分享测试版小程序-默认图</button></li>
    <li><button onclick="fetchShareMiniProgramCustomerImage()">分享测试版小程序-自定义图</button></li>
    <li><button onclick="fetchShareMiniProgramSnapshotImage()">分享测试版小程序-屏幕截图</button></li>
    <li><button onclick="fetchShareMiniProgramSnapshotFull()">分享测试版小程序-屏幕长图</button></li>

    <li><button onclick="fetchShareMiniProgramFromNativePreview()">分享体验版小程序-默认图</button></li>
    <li><button onclick="fetchShareMiniProgramCustomerImagePreview()">分享体验版小程序-自定义图</button></li>
    <li><button onclick="fetchShareMiniProgramSnapshotImagePreview()">分享体验版小程序-屏幕截图</button></li>
    <li><button onclick="fetchShareMiniProgramSnapshotFullPreview()">分享体验版小程序-屏幕长图</button></li>

       <li><button onclick="fetchShareMiniProgramFromNativeRelease()">分享正式版小程序-默认图</button></li>
    <li><button onclick="fetchShareMiniProgramCustomerImageRelease()">分享正式版小程序-自定义图</button></li>
    <li><button onclick="fetchShareMiniProgramSnapshotImageRelease()">分享正式版小程序-屏幕截图</button></li>
    <li><button onclick="fetchShareMiniProgramSnapshotFullRelease()">分享正式版小程序-屏幕长图</button></li>

    <li><button onclick="launchMiniProgramTest()">打开测试版小程序</button></li>
    <li><button onclick="launchMiniProgramPreview()">打开体验版小程序</button></li>
    <li><button onclick="launchMiniProgramRelease()">打开正式版小程序</button></li>
    <li><button onclick="printCookies()">print cookies</button></li>
    <li><button onclick="fetchStoreInfoAPI()">fetchStoreInfoAPI</button></li>
    <li><button onclick="addBundleToCart()">添加套装</button></li>
    <li><button onclick="addGoodsToCart()">添加商品</button></li>
</ul>

<img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1535110382275&di=6d1fea942f0df769b6e21414000e259f&imgtype=0&src=http%3A%2F%2F8btc.com%2Fdata%2Fattachment%2Fforum%2F201807%2F01%2F195521zcjn8silegp742qx.jpg" border="1" width="200", height="200">

<img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1533963043027&di=50d8dc1404eae8b5075ea189a58470ba&imgtype=0&src=http%3A%2F%2Feasyread.ph.126.net%2FVEbgVf7FNfBi3Ot9KCIAPA%3D%3D%2F7916714617432377848.jpg" border="1" width="400">
<img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1533963111228&di=dca21c972cdc711167529dccda3df86b&imgtype=0&src=http%3A%2F%2Fn.sinaimg.cn%2Ftranslate%2F93%2Fw580h313%2F20180423%2F4tVN-fznefki0285861.jpg" border="1" width="400">

<img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1535110907861&di=2420d63f58187b4feee90c46520fc4fd&imgtype=0&src=http%3A%2F%2Fimg3.xhdxly.com%2Fpublic%2Fxcx_tu.jpg" border="1" width="200", height="200">





</body>
</html>
